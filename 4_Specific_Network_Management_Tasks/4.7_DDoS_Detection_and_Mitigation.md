---
title: "4.7. DDoS的检测与缓解"
anchor: "4.7_DDoS_Detection_and_Mitigation"
weight: 407
rank: "h2"
---

On-path observation of the transport headers of packets can be used for various security functions. For example, Denial of Service (DoS) and Distributed DoS (DDoS) attacks against the infrastructure or against an endpoint can be detected and mitigated by characterizing anomalous traffic. Other uses include support for security audits (e.g., verifying the compliance with cipher suites), client and application fingerprinting for inventory, and providing alerts for network intrusion detection and other next-generation firewall functions.

在路径上对于数据包传输层协议头部的观察结果可以被用于各种安全功能。例如，可以通过拾取流量异常特征的方式来检测和缓解针对基础设施或终端的拒绝服务（DoS）与分布式拒绝服务（DDoS）攻击。其他用途还包括对安全审计、客户端与应用指纹收集、网络入侵检测以及下一代防火墙功能的支持。

Current practices in detection and mitigation of DDoS attacks generally involve classification of incoming traffic (as packets, flows, or some other aggregate) into "good" (productive) and "bad" (DDoS) traffic, and then differential treatment of this traffic to forward only good traffic. This operation is often done in a separate specialized mitigation environment through which all traffic is filtered; a generalized architecture for separation of concerns in mitigation is given in [DOTS-ARCH].

目前对于检测和缓解DDoS攻击的实践中通常包含将传入流量（例如数据包、流量，或其他合计量）分类为“好”（有益的）流量和“坏”（DDoS）流量，再差异化流量待遇，仅转发“好”流量的步骤。该操作经常是在专用于缓解攻击的独立环境中进行的，所有流量都会在其中得到过滤；《[DOTS-ARCH]()》中给出了一种架构，它能够将缓解过程中的关注点分离。

Efficient classification of this DDoS traffic in the mitigation environment is key to the success of this approach. Limited first packet garbage detection as in Section 3.1.2 and stateful tracking of QUIC traffic as mentioned in Section 4.2 above may be useful during classification.

在这种缓解环境中能否对DDoS流量进行高效的分类是该方法能否成功的关键。在分类过程中，如[第3.1.2章]()中所述的受限的首包识别和如[第4.2章]()中所述的针对QUIC流量的有状态跟踪或许能派上用场。

Note that using a connection ID to support connection migration renders 5-tuple-based filtering insufficient to detect active flows and requires more state to be maintained by DDoS defense systems if support of migration of QUIC flows is desired. For the common case of NAT rebinding, where the client's address changes without the client's intent or knowledge, DDoS defense systems can detect a change in the client's endpoint address by linking flows based on the server's connection IDs. However, QUIC's linkability resistance ensures that a deliberate connection migration is accompanied by a change in the connection ID. In this case, the connection ID cannot be used to distinguish valid, active traffic from new attack traffic.

注意，使用连接ID来支持连接迁移的做法会使得基于五元组的过滤变得不足以应对有效流量检测，且在需要支持QUIC流量迁移时令DDoS防御系统维护更多状态。对于NAT重绑定的常见情况，也就是客户端在不知情的状态下发生了地址变化，DDoS防御系统可以通过基于服务器的连接ID来关联流量的方法来检测客户端地址的变化。不过，QUIC的可关联性抑制机制确保了主动的连接迁移一定伴随着连接ID的变化。在这种情况下，连接ID就不能被用来将有效的迁移后流量与新的攻击流量区分开来。

It is also possible for endpoints to directly support security functions such as DoS classification and mitigation. Endpoints can cooperate with an in-network device directly by e.g., sharing information about connection IDs.

终端有可能直接支持DoS归类及缓解等安全功能。终端可以通过共享连接ID信息等方式直接与网络内的设备协作。

Another potential method could use an on-path network device that relies on pattern inferences in the traffic and heuristics or machine learning instead of processing observed header information.

相较于对观察到的头部信息进行处理，另一个潜在的方法是使用在路径上的依靠流量模式推断和启发式方法甚至机器学习来运作的网络设备。

However, it is questionable whether connection migrations must be supported during a DDoS attack. While unintended migration without a connection ID change can be supported much easier, it might be acceptable to not support migrations of active QUIC connections that are not visible to the network functions performing the DDoS detection. As soon as the connection blocking is detected by the client, the client may be able to rely on the 0-RTT data mechanism provided by QUIC. When clients migrate to a new path, they should be prepared for the migration to fail and attempt to reconnect quickly.

不过，要不要在DDoS攻击期间支持连接迁移这一问题还没有定论。尽管要支持不带连接ID变化的不经意迁移并不困难，但是如果某条活跃的QUIC连接发生了迁移，但是它对于检测DDoS的网络功能来说不可见，那么放弃支持这类迁移的做法也是可以接受的。只要连接的拦截行为被客户端检测到，客户端或许就有能力改用QUIC提供的0-RTT数据机制。当客户端迁移至新路径时，它们应该做好迁移失败的准备，并快速尝试重连。

Beyond in-network DDoS protection mechanisms, TCP SYN cookies [RFC4987] are a well-established method of mitigating some kinds of TCP DDoS attacks. QUIC Retry packets are the functional analogue to SYN cookies, forcing clients to prove possession of their IP address before committing server state. However, there are safeguards in QUIC against unsolicited injection of these packets by intermediaries who do not have consent of the end server. See [QUIC-RETRY] for standard ways for intermediaries to send Retry packets on behalf of consenting servers.

在网络内的DDoS保护机制之外，TCP SYN cookie（详见《[RFC4987]()》）也是一种广泛使用的用于缓解部分TCP DDoS攻击的方法。QUIC的重试数据包与SYN cookie在功能上是等价的，它能够强制客户端在改变服务器状态前提供其IP地址真实性的证明。只不过，QUIC中有一些保护措施，能够防止未经服务器同意的中间设备主动注入这类数据包。有关中间设备如何在已获批准时代表服务器发送重试数据包的标准做法，详见《[QUIC-RETRY]()》。
